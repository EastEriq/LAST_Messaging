# Exploiting matlab callbacks for event response and resource protection

A matlab session, as known, evaluates matlab code serially, in a single threaded, event loop based model.
To be clear, I stress that I refer here to matlab code run by the matlab interpreter
(or to say better JIT compiler). I'm not referring to

1. multithreaded code running in compiled mex files, or externally dynamically linked libraries

2. parpool evaluations

Both of them fall out of the scope of running within the calling matlab session, have their own issues about exchange of data with them while they are running, and won't be discussed here.

## Types of callbacks tested in our codebase

### Serial or UDP terminator received callbacks

### timer callbacks

### class property changed callbacks

## interruptible and noninterruptible callbacks

While matlab is executing the code of a callback which is interruptible, a second event can launch a callback,
which spawns the execution of a function at the moment it comes, whatever the first one was doing, and returns
to it at completion. I haven't checked the exact granularity of where the interruption occurs, it is probably
between statement and statement.

Uninterruptible callbacks, instead, are not interrupted. If a callback event occurs while they are executing,
it is enqueued in a special event queue, and the execution of the corresponding function is fired only after
the first terminates. Further events are all enqueued and processed in the order they arrive. I haven't tested how deep is that queue, or what is the behavior if events launching interruptible and noninterruptible callbacks
intervene in mixed order.

The Matlab documentation mentions cursively the fact that some callbacks can be configured in either way,
but is otherwise completely silent. The only callbacks which offer this option are callbacks produced by
user interaction with an element in a Figure window (for example `uicontrol`s, or figure action elements).


## exploiting callbacks for resource protection

The typical use case is that of a query of an instrument using a message passing protocol. The computer
sends a query message on a resource (e.g. a serial or tcp port) and waits for a reply. In the simplest
acception we don't want that this transaction is disturbed by a callback intervening between the request
and the reception of the reply, with another query. In most scenarios the intervening query will receive
inappropriately the answer to the first request, exit with it, and the first query will receive nothing
or the reply to the second request.